# レイヤー分け

- アプリケーション層
- ドメイン層
- インフラストラクチャ層

アプリケーション層とインフラストラクチャ層は、ドメイン層に依存OK  
<B>ドメイン層が他の層に依存するのはNG</B>

## アプリケーション層
クライアントとのデータの入出力の ___<u>制御</u>___ をする層  
ビジネスルールを含んではいけない

- データの入出力をするUIの提供
- クライアントからのリクエストハンドリング
- 入力データの妥当性チェック
- リクエスト内容に対応するドメイン層のコンポーネント呼び出し

### アプリケーション層のコンポーネント

#### Controller

- 画面遷移の制御
- ドメイン層のServiceの呼び出し

#### View
- クライアントへの出力
- HTML/JSON/PDFなど

#### Form
- HTMLのフォームを表現(データをContollerに渡したり、処理結果をフォームに出力)、フォームそのものではなくデータ構造など
- 入力チェックルールの宣言

ドメイン層がアプリケーション層に依存しないために、以下の変換処理はアプリケーション層で行う
- FormからDomain Objectへの変換処理
- Domain ObjectからFormへの変換処理
 
#### Helper

- Controllerの補助？

## ドメイン層
アプリケーションのコア、ビジネスルールを実行する

- Domain Object
- Domain Objectに対するビジネスるーるのチェック
    - 口座へ入金する場合、残高が十分であるかどうかのチェックなど
- Domain Objectに対するビジネスルールの実行
    - ビジネスルールに則った値の反映
- Domain Objectに対するCRUD操作

### ドメイン層のコンポーネント

#### Domain Object

- CustomerやProductなどのリソース系モデル
    - 名詞で表現される
- OrderやPaymentなどのイベント系モデル
    - 動詞で表現される
- YearlySalesやMonthlySalesなどのサマリ系モデル
- データベースのテーブル1レコードを表現するクラスEntity

#### Repository
Domain Objectのコレクションのようなもの、Domain Objectに対するCRUDを担う
ドメイン層ではインターフェースのみ定義する。実態はインフラストラクチャ層で実装する。

#### Service

業務処理を提供する。処理フローを持つ

Serviceでは、FormやHttpRequestなど、Webに関わる情報を扱うべきではない、
Serviceメソッドを呼び出す前に、アプリケーション層でドメイン層のオブジェクトに変換するべき。




